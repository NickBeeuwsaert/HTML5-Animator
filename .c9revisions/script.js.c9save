{"ts":1351470341332,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"/*global requestAnimationFrame:false,superCanvas:false,openFile:false */\nvar setCurrentFrame;\nvar getCurrentFrame;\nvar getTotalFrames;\nvar animatorNamespace = \"hi\";\nvar drawTimeline;\n(function(){\n    var currentFrameNo = 0;\n    var totalFrames = 0;\n    getTotalFrames = function(){\n        return totalFrames;\n    };\n    var frameSelect = document.querySelector(\"#frameRange\");\n    setCurrentFrame = function(newFrame){\n        frameSelect.value = currentFrameNo = newFrame;\n    };\n    frameSelect.addEventListener(\"change\", function(){\n        setCurrentFrame(parseInt(this.value, 10));\n    }, false);\n    getCurrentFrame = function(){\n        return currentFrameNo;\n    };\n    var layerHeader = document.querySelector(\".layers .layerHeader\");\n    var frameHeader = document.querySelector(\".keyframes .frameHeader\");\n    \n    var frames = document.querySelector(\".keyframes .frames\");\n    var layers = document.querySelector(\".layers .layers\");\n    \n    \n    var layerHCtx = superCanvas(layerHeader);\n    var frameHCtx = superCanvas(frameHeader);\n    \n    var frameCtx = superCanvas(frames);\n    var layerCtx = superCanvas(layers);\n    //Preperation, create some patterns\n    var canvas = document.createElement(\"canvas\");\n    var context = superCanvas(canvas);\n    canvas.width = 10;\n    canvas.height = 20;\n    \n    context.drawPath(\"M10,0 10,20 0,20\");\n    context.stroke();\n    var grid = context.createPattern(canvas, \"repeat\");\n    \n    canvas.width = 10*5;\n    canvas.height = 20;\n    \n    context.drawPath(\"M40,0 50,0 50,20 40,20\");\n    context.fillStyle=\"#eee\";\n    context.fill();\n    var visibleLayer = superCanvas.bakeMatrixIntoPath(superCanvas.Matrix().scale(1/28,1/28).scale(20,20), superCanvas.parsePath(\"M16,8.286C8.454,8.286,2.5,16,2.5,16s5.954,7.715,13.5,7.715c5.771,0,13.5-7.715,13.5-7.715S21.771,8.286,16,8.286zM16,20.807c-2.649,0-4.807-2.157-4.807-4.807s2.158-4.807,4.807-4.807s4.807,2.158,4.807,4.807S18.649,20.807,16,20.807zM16,13.194c-1.549,0-2.806,1.256-2.806,2.806c0,1.55,1.256,2.806,2.806,2.806c1.55,0,2.806-1.256,2.806-2.806C18.806,14.451,17.55,13.194,16,13.194z\"));\n    var invisibleLayer = superCanvas.bakeMatrixIntoPath(superCanvas.Matrix().scale(1/28,1/28).scale(20,20),superCanvas.parsePath(\"M11.478,17.568c-0.172-0.494-0.285-1.017-0.285-1.568c0-2.65,2.158-4.807,4.807-4.807c0.552,0,1.074,0.113,1.568,0.285l2.283-2.283C18.541,8.647,17.227,8.286,16,8.286C8.454,8.286,2.5,16,2.5,16s2.167,2.791,5.53,5.017L11.478,17.568zM23.518,11.185l-3.056,3.056c0.217,0.546,0.345,1.138,0.345,1.76c0,2.648-2.158,4.807-4.807,4.807c-0.622,0-1.213-0.128-1.76-0.345l-2.469,2.47c1.327,0.479,2.745,0.783,4.229,0.783c5.771,0,13.5-7.715,13.5-7.715S26.859,13.374,23.518,11.185zM25.542,4.917L4.855,25.604L6.27,27.02L26.956,6.332L25.542,4.917z\"));\n    var everyfill = context.createPattern(canvas, \"repeat\");\n    var timelineGradient = context.createLinearGradient(0, 0, 0, 20);\n    timelineGradient.addColorStop(0, \"#d0d0d0\");\n    timelineGradient.addColorStop(0.7, \"#d0d0d0\");\n    timelineGradient.addColorStop(1, \"#b4b4b4\");\n    var draw = function(doc){\n        //Draw the headers....\n        //layers\n        layerHeader.width = layerHeader.parentNode.clientWidth;\n        layerHeader.height=20;\n        layerHCtx.fillStyle=timelineGradient;\n        layerHCtx.fillRect(0,0, layerHeader.width, layerHeader.height);\n        \n        frameHeader.width = frameHeader.parentNode.clientWidth;\n        frameHeader.height=20;\n        frameHCtx.fillStyle=timelineGradient;\n        frameHCtx.fillRect(0,0, frameHeader.width, frameHeader.height);\n        frameHCtx.save();\n        frameHCtx.rect(0,0,frameHeader.width,3);\n        frameHCtx.rect(0,17,frameHeader.width, 3);\n        frameHCtx.clip();\n        frameHCtx.translate(-frameHeader.parentNode.scrollLeft, 0);\n        frameHCtx.fillStyle=grid;\n        frameHCtx.fillRect(frameHeader.parentNode.scrollLeft,0,frameHeader.width, 20);\n        frameHCtx.restore();\n        frameHCtx.font = \"12px monospace\";\n        //Draw the frame numbers...\n        frameHCtx.fillStyle=\"black\";\n        frameHCtx.translate(-frameHeader.parentNode.scrollLeft, 0);\n        for(var i = 0; i < frameHeader.parentNode.scrollWidth; i+=5){\n            var width = frameHCtx.measureText(i).width/2;\n            frameHCtx.fillText(i, i*10-width+5, 20-6);\n        }\n        //Draw the current Frame\n        frameHCtx.fillStyle = \"rgba(255,0,0,0.5)\";\n        frameHCtx.fillRect(currentFrameNo*10, 0, 10, 20);\n        //Draw te bodies\n        \n        // layers...\n        layers.width=layers.parentNode.clientWidth;\n        layers.height=layers.parentNode.clientHeight-20;\n        layerCtx.font = \"12px monospace\";\n        layerCtx.fillStyle=\"rgb(230,230,230)\";\n        layerCtx.fillRect(0,0,layers.width, layers.height);\n        layerCtx.translate(0, -frames.parentNode.scrollTop);\n        var layersArray = [];\n        if(doc){\n            var docRoot = doc.documentElement;\n            var layerNum = 0;\n            for(var i = 0; i != docRoot.childNodes.length; i++){\n                var node = docRoot.childNodes[i];\n                if(node.nodeName == \"g\"){\n                    layersArray.push(node);\n                    layerCtx.save();\n                    layerCtx.translate(0,layerNum*20);\n                    layerCtx.save();\n                    layerCtx.beginPath();\n                    layerCtx.rect(0,0,layers.width,20);\n                    layerCtx.closePath();\n                    layerCtx.clip();\n                    layerCtx.rect(0,0,layers.width,20);\n                    \n                    layerCtx.fillStyle=\"rgba(212,208,200,1)\";\n                    layerCtx.fill();\n                    layerCtx.strokeStyle=\"white\";\n                    layerCtx.beginPath();\n                    layerCtx.moveTo(0,0);\n                    layerCtx.lineTo(layers.width,0);\n                    layerCtx.stroke();\n                    layerCtx.closePath();\n                    \n                    layerCtx.strokeStyle=\"rgb(128,128,128)\";\n                    layerCtx.beginPath();\n                    layerCtx.moveTo(0,20);\n                    layerCtx.lineTo(layers.width,20);\n                    layerCtx.stroke();\n                    layerCtx.closePath();\n                    \n                    layerCtx.restore();\n                    layerCtx.fillStyle=\"black\";\n                    layerCtx.fillText(node.getAttributeNS(animatorNamespace,\"label\") || (\"layer\"+layerNum), 0, 20-6);\n                    \n                    layerCtx.save();\n                    layerCtx.translate(layers.width-28,0);\n                    if(node.style.display==\"none\"){\n                        layerCtx.drawPath(invisibleLayer);\n                    }else{\n                        layerCtx.drawPath(visibleLayer);\n                    }\n                    layerCtx.fill();\n                    layerCtx.restore();\n                    layerCtx.restore();\n                    layerNum++;\n                }\n            }\n        }\n        //frames...\n        var maxWidth = frames.parentNode.clientWidth/10;\n        for(i = 0; i < layersArray.length; i++){\n            var mLength = 0;\n            var L = layersArray[i];\n            for(k = 0; k < L.childNodes.length; k++){\n                if(L.childNodes[k].nodeName!=\"g\") continue;\n                mLength += parseInt(L.childNodes[k].getAttributeNS(animatorNamespace, \"length\"), 10)||0;\n            }\n            maxWidth = Math.max(mLength, maxWidth);\n        }\n        //add 10 to maxWidth so that the user can see a bit past the end\n        totalFrames = maxWidth;\n        frames.width = (maxWidth + 10) * 10;\n        frames.height = Math.max((frames.parentNode.clientHeight-20), layersArray.length*10);\n        frameCtx.fillStyle = grid;\n        frameCtx.fillRect(0,0,frames.width, frames.height);\n        \n        //Now, draw the keyframes\n        for(i = 0; i < layersArray.length; i++){\n            var at = 0;\n            var L = layersArray[i];\n            for(var k = 0; k < L.childNodes.length; k++){\n                var frame = L.childNodes[k];\n                if(frame.nodeName != \"g\")continue;\n                var l = parseInt(frame.getAttributeNS(animatorNamespace, \"length\"),10)||1;\n                frameCtx.fillStyle=\"white\";\n                frameCtx.strokeStyle=\"black\";\n                //frameCtx.lineWidth = 0.5;\n                frameCtx.save();\n                frameCtx.translate(at*10, i * 20);\n                frameCtx.beginPath();\n                frameCtx.rect(1,0,l*10-2, 20-1);\n                frameCtx.closePath();\n                frameCtx.fill();\n                //frameCtx.stroke();\n                frameCtx.beginPath();\n                frameCtx.arc(5,15, 2, 0, Math.PI*2, false);\n                frameCtx.fillStyle=\"black\";\n                frameCtx.fill();\n                frameCtx.stroke();\n                frameCtx.closePath();\n                frameCtx.restore();\n                at+=l;\n            }\n        }\n        frameCtx.beginPath();\n        frameCtx.strokeStyle = \"rgba(255,0,0,0.5)\";\n        frameCtx.moveTo(currentFrameNo*10 + 5,0);\n        frameCtx.lineTo(currentFrameNo*10 + 5, frames.height);\n        frameCtx.stroke();\n        frameCtx.closePath();\n        \n        //requestAnimationFrame(function(){draw(doc);});\n    };\n    var frameClickHandler = function(e){\n        var x = (e.offsetX||e.layerX) + e.target.parentElement.scrollLeft;\n        var frameN = Math.floor(x/10);\n        //console.log(x, frameN);\n        setCurrentFrame(frameN);\n    };\n    var mousedown = false;\n    frameHeader.addEventListener(\"mousedown\", frameClickHandler, false);\n    frameHeader.addEventListener(\"mousedown\", function(){ mousedown = true; }, false);\n    frameHeader.addEventListener(\"mouseup\", function(){ mousedown = false; }, false);\n    frameHeader.addEventListener(\"mousemove\", function(e){\n        if(mousedown) frameClickHandler(e);\n    }, false);\n    drawTimeline = draw;\n    //\n    //draw();\n})();\n"]],"start1":0,"start2":0,"length1":0,"length2":9901}]],"length":9901}
{"contributors":[],"silentsave":false,"ts":1351470341192,"patch":[[{"diffs":[[1,"/*global requestAnimationFrame:false,superCanvas:false,openFile:false */\nvar setCurrentFrame;\nvar getCurrentFrame;\nvar getTotalFrames;\nvar animatorNamespace = \"hi\";\nvar drawTimeline;\n(function(){\n    var currentFrameNo = 0;\n    var totalFrames = 0;\n    getTotalFrames = function(){\n        return totalFrames;\n    };\n    var frameSelect = document.querySelector(\"#frameRange\");\n    setCurrentFrame = function(newFrame){\n        frameSelect.value = currentFrameNo = newFrame;\n    };\n    frameSelect.addEventListener(\"change\", function(){\n        setCurrentFrame(parseInt(this.value, 10));\n    }, false);\n    getCurrentFrame = function(){\n        return currentFrameNo;\n    };\n    var layerHeader = document.querySelector(\".layers .layerHeader\");\n    var frameHeader = document.querySelector(\".keyframes .frameHeader\");\n    \n    var frames = document.querySelector(\".keyframes .frames\");\n    var layers = document.querySelector(\".layers .layers\");\n    \n    \n    var layerHCtx = superCanvas(layerHeader);\n    var frameHCtx = superCanvas(frameHeader);\n    \n    var frameCtx = superCanvas(frames);\n    var layerCtx = superCanvas(layers);\n    //Preperation, create some patterns\n    var canvas = document.createElement(\"canvas\");\n    var context = superCanvas(canvas);\n    canvas.width = 10;\n    canvas.height = 20;\n    \n    context.drawPath(\"M10,0 10,20 0,20\");\n    context.stroke();\n    var grid = context.createPattern(canvas, \"repeat\");\n    \n    canvas.width = 10*5;\n    canvas.height = 20;\n    \n    context.drawPath(\"M40,0 50,0 50,20 40,20\");\n    context.fillStyle=\"#eee\";\n    context.fill();\n    var visibleLayer = superCanvas.bakeMatrixIntoPath(superCanvas.Matrix().scale(1/28,1/28).scale(20,20), superCanvas.parsePath(\"M16,8.286C8.454,8.286,2.5,16,2.5,16s5.954,7.715,13.5,7.715c5.771,0,13.5-7.715,13.5-7.715S21.771,8.286,16,8.286zM16,20.807c-2.649,0-4.807-2.157-4.807-4.807s2.158-4.807,4.807-4.807s4.807,2.158,4.807,4.807S18.649,20.807,16,20.807zM16,13.194c-1.549,0-2.806,1.256-2.806,2.806c0,1.55,1.256,2.806,2.806,2.806c1.55,0,2.806-1.256,2.806-2.806C18.806,14.451,17.55,13.194,16,13.194z\"));\n    var invisibleLayer = superCanvas.bakeMatrixIntoPath(superCanvas.Matrix().scale(1/28,1/28).scale(20,20),superCanvas.parsePath(\"M11.478,17.568c-0.172-0.494-0.285-1.017-0.285-1.568c0-2.65,2.158-4.807,4.807-4.807c0.552,0,1.074,0.113,1.568,0.285l2.283-2.283C18.541,8.647,17.227,8.286,16,8.286C8.454,8.286,2.5,16,2.5,16s2.167,2.791,5.53,5.017L11.478,17.568zM23.518,11.185l-3.056,3.056c0.217,0.546,0.345,1.138,0.345,1.76c0,2.648-2.158,4.807-4.807,4.807c-0.622,0-1.213-0.128-1.76-0.345l-2.469,2.47c1.327,0.479,2.745,0.783,4.229,0.783c5.771,0,13.5-7.715,13.5-7.715S26.859,13.374,23.518,11.185zM25.542,4.917L4.855,25.604L6.27,27.02L26.956,6.332L25.542,4.917z\"));\n    var everyfill = context.createPattern(canvas, \"repeat\");\n    var timelineGradient = context.createLinearGradient(0, 0, 0, 20);\n    timelineGradient.addColorStop(0, \"#d0d0d0\");\n    timelineGradient.addColorStop(0.7, \"#d0d0d0\");\n    timelineGradient.addColorStop(1, \"#b4b4b4\");\n    var draw = function(doc){\n        //Draw the headers....\n        //layers\n        layerHeader.width = layerHeader.parentNode.clientWidth;\n        layerHeader.height=20;\n        layerHCtx.fillStyle=timelineGradient;\n        layerHCtx.fillRect(0,0, layerHeader.width, layerHeader.height);\n        \n        frameHeader.width = frameHeader.parentNode.clientWidth;\n        frameHeader.height=20;\n        frameHCtx.fillStyle=timelineGradient;\n        frameHCtx.fillRect(0,0, frameHeader.width, frameHeader.height);\n        frameHCtx.save();\n        frameHCtx.rect(0,0,frameHeader.width,3);\n        frameHCtx.rect(0,17,frameHeader.width, 3);\n        frameHCtx.clip();\n        frameHCtx.translate(-frameHeader.parentNode.scrollLeft, 0);\n        frameHCtx.fillStyle=grid;\n        frameHCtx.fillRect(frameHeader.parentNode.scrollLeft,0,frameHeader.width, 20);\n        frameHCtx.restore();\n        frameHCtx.font = \"12px monospace\";\n        //Draw the frame numbers...\n        frameHCtx.fillStyle=\"black\";\n        frameHCtx.translate(-frameHeader.parentNode.scrollLeft, 0);\n        for(var i = 0; i < frameHeader.parentNode.scrollWidth; i+=5){\n            var width = frameHCtx.measureText(i).width/2;\n            frameHCtx.fillText(i, i*10-width+5, 20-6);\n        }\n        //Draw the current Frame\n        frameHCtx.fillStyle = \"rgba(255,0,0,0.5)\";\n        frameHCtx.fillRect(currentFrameNo*10, 0, 10, 20);\n        //Draw te bodies\n        \n        // layers...\n        layers.width=layers.parentNode.clientWidth;\n        layers.height=layers.parentNode.clientHeight-20;\n        layerCtx.font = \"12px monospace\";\n        layerCtx.fillStyle=\"rgb(230,230,230)\";\n        layerCtx.fillRect(0,0,layers.width, layers.height);\n        layerCtx.translate(0, -frames.parentNode.scrollTop);\n        var layersArray = [];\n        if(doc){\n            var docRoot = doc.documentElement;\n            var layerNum = 0;\n            for(var i = 0; i != docRoot.childNodes.length; i++){\n                var node = docRoot.childNodes[i];\n                if(node.nodeName == \"g\"){\n                    layersArray.push(node);\n                    layerCtx.save();\n                    layerCtx.translate(0,layerNum*20);\n                    layerCtx.save();\n                    layerCtx.beginPath();\n                    layerCtx.rect(0,0,layers.width,20);\n                    layerCtx.closePath();\n                    layerCtx.clip();\n                    layerCtx.rect(0,0,layers.width,20);\n                    \n                    layerCtx.fillStyle=\"rgba(212,208,200,1)\";\n                    layerCtx.fill();\n                    layerCtx.strokeStyle=\"white\";\n                    layerCtx.beginPath();\n                    layerCtx.moveTo(0,0);\n                    layerCtx.lineTo(layers.width,0);\n                    layerCtx.stroke();\n                    layerCtx.closePath();\n                    \n                    layerCtx.strokeStyle=\"rgb(128,128,128)\";\n                    layerCtx.beginPath();\n                    layerCtx.moveTo(0,20);\n                    layerCtx.lineTo(layers.width,20);\n                    layerCtx.stroke();\n                    layerCtx.closePath();\n                    \n                    layerCtx.restore();\n                    layerCtx.fillStyle=\"black\";\n                    layerCtx.fillText(node.getAttributeNS(animatorNamespace,\"label\") || (\"layer\"+layerNum), 0, 20-6);\n                    \n                    layerCtx.save();\n                    layerCtx.translate(layers.width-28,0);\n                    if(node.style.display==\"none\"){\n                        layerCtx.drawPath(invisibleLayer);\n                    }else{\n                        layerCtx.drawPath(visibleLayer);\n                    }\n                    layerCtx.fill();\n                    layerCtx.restore();\n                    layerCtx.restore();\n                    layerNum++;\n                }\n            }\n        }\n        //frames...\n        var maxWidth = frames.parentNode.clientWidth/10;\n        for(i = 0; i < layersArray.length; i++){\n            var mLength = 0;\n            var L = layersArray[i];\n            for(k = 0; k < L.childNodes.length; k++){\n                if(L.childNodes[k].nodeName!=\"g\") continue;\n                mLength += parseInt(L.childNodes[k].getAttributeNS(animatorNamespace, \"length\"), 10)||0;\n            }\n            maxWidth = Math.max(mLength, maxWidth);\n        }\n        //add 10 to maxWidth so that the user can see a bit past the end\n        totalFrames = maxWidth;\n        frames.width = (maxWidth + 10) * 10;\n        frames.height = Math.max((frames.parentNode.clientHeight-20), layersArray.length*10);\n        frameCtx.fillStyle = grid;\n        frameCtx.fillRect(0,0,frames.width, frames.height);\n        \n        //Now, draw the keyframes\n        for(i = 0; i < layersArray.length; i++){\n            var at = 0;\n            var L = layersArray[i];\n            for(var k = 0; k < L.childNodes.length; k++){\n                var frame = L.childNodes[k];\n                if(frame.nodeName != \"g\")continue;\n                var l = parseInt(frame.getAttributeNS(animatorNamespace, \"length\"),10)||1;\n                frameCtx.fillStyle=\"white\";\n                frameCtx.strokeStyle=\"black\";\n                //frameCtx.lineWidth = 0.5;\n                frameCtx.save();\n                frameCtx.translate(at*10, i * 20);\n                frameCtx.beginPath();\n                frameCtx.rect(1,0,l*10-2, 20-1);\n                frameCtx.closePath();\n                frameCtx.fill();\n                //frameCtx.stroke();\n                frameCtx.beginPath();\n                frameCtx.arc(5,15, 2, 0, Math.PI*2, false);\n                frameCtx.fillStyle=\"black\";\n                frameCtx.fill();\n                frameCtx.stroke();\n                frameCtx.closePath();\n                frameCtx.restore();\n                at+=l;\n            }\n        }\n        frameCtx.beginPath();\n        frameCtx.strokeStyle = \"rgba(255,0,0,0.5)\";\n        frameCtx.moveTo(currentFrameNo*10 + 5,0);\n        frameCtx.lineTo(currentFrameNo*10 + 5, frames.height);\n        frameCtx.stroke();\n        frameCtx.closePath();\n        \n        //requestAnimationFrame(function(){draw(doc);});\n    };\n    var frameClickHandler = function(e){\n        var x = (e.offsetX||e.layerX) + e.target.parentElement.scrollLeft;\n        var frameN = Math.floor(x/10);\n        //console.log(x, frameN);\n        setCurrentFrame(frameN);\n    };\n    var mousedown = false;\n    frameHeader.addEventListener(\"mousedown\", frameClickHandler, false);\n    frameHeader.addEventListener(\"mousedown\", function(){ mousedown = true; }, false);\n    frameHeader.addEventListener(\"mouseup\", function(){ mousedown = false; }, false);\n    frameHeader.addEventListener(\"mousemove\", function(e){\n        if(mousedown) frameClickHandler(e);\n    }, false);\n    drawTimeline = draw;\n    //\n    //draw();\n})();\n"]],"start1":0,"start2":0,"length1":0,"length2":9901}]],"length":9901,"saved":false}
